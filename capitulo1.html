<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cap√≠tulo 1: Los Secretos del Hardware y Software - Arcanum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap');
        
        .fantasy-bg {
            background: linear-gradient(135deg, #7c2d12 0%, #dc2626 50%, #ea580c 100%);
            position: relative;
        }
        
        .fantasy-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }
        
        .magical-glow {
            animation: glow 3s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 40px rgba(220, 38, 38, 0.5); }
        }
        
        .mission-card {
            transition: all 0.3s ease;
        }
        
        .mission-card:hover {
            transform: translateY(-5px);
        }
        
        .component-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .quiz-option {
            transition: all 0.3s ease;
        }
        
        .quiz-option:hover {
            transform: scale(1.02);
        }
        
        .correct {
            background: linear-gradient(135deg, #059669, #10b981) !important;
            animation: correctPulse 0.5s ease;
        }
        
        .incorrect {
            background: linear-gradient(135deg, #dc2626, #ef4444) !important;
            animation: shake 0.5s ease;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .roulette-wheel {
            animation: spin 4s ease-in-out;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(1440deg); }
        }
    </style>
</head>
<body class="fantasy-bg min-h-screen text-white font-inter">
    <!-- Header -->
    <header class="relative z-10 p-6">
        <div class="flex justify-between items-center">
            <button onclick="goHome()" class="bg-black bg-opacity-30 hover:bg-opacity-50 rounded-lg px-4 py-2 transition-all">
                ‚Üê Volver al Mapa
            </button>
            <div class="text-center">
                <h1 class="font-cinzel text-3xl font-bold magical-glow">üß≠ Los Secretos del Hardware y Software</h1>
                <p class="text-lg opacity-90">Cap√≠tulo 1 - Fundamentos Digitales</p>
            </div>
            <div class="flex gap-4">
                <div class="bg-black bg-opacity-30 rounded-lg px-4 py-2 text-center">
                    <div class="text-lg font-bold text-yellow-300" id="points">0</div>
                    <div class="text-xs opacity-80">Puntos</div>
                </div>
                <div class="bg-black bg-opacity-30 rounded-lg px-4 py-2 text-center">
                    <div class="text-lg font-bold text-green-300" id="toolCount">0/6</div>
                    <div class="text-xs opacity-80">Herramientas</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Ruleta del Destino -->
    <section class="relative z-10 max-w-4xl mx-auto px-6 mb-8">
        <div class="bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl p-6 backdrop-blur-sm text-center">
            <h2 class="font-cinzel text-2xl font-bold mb-4">üé∞ Ruleta del Destino</h2>
            <div class="flex items-center justify-center gap-6">
                <div class="text-4xl" id="rouletteWheel">üéØ</div>
                <div>
                    <p class="text-sm opacity-90 mb-2">Gira para obtener ayudas especiales</p>
                    <button id="spinRouletteBtn" onclick="spinRoulette()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg font-semibold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        üé∞ Girar (10 pts)
                    </button>
                </div>
                <div class="text-xs opacity-70" id="rouletteStatus">Requiere 20 puntos</div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="relative z-10 max-w-6xl mx-auto px-6 pb-12">
        
<!-- Story Introduction -->
<section class="mb-12 relative min-h-[600px]" id="storyIntro">
    <!-- Video de fondo -->
    <div class="relative w-full h-[600px] rounded-xl overflow-hidden">
        <video id="bgVideo" playsinline class="absolute inset-0 w-full h-full object-cover">
            <source src="1.mp4" type="video/mp4">
            Tu navegador no soporta video en HTML5.
        </video>
        <!-- T√≠tulo encima del video -->
        <div class="relative z-10 flex justify-center h-full text-white text-4xl font-bold">
            ¬°El Laboratorio Digital Est√° en Caos!
        </div>
    </div>

    <!-- Botones debajo del video -->
    <div class="flex justify-center space-x-6 mt-6">
        <button onclick="startChapter()" 
                class="bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 px-8 py-4 rounded-lg font-bold text-xl transition-all">
            üîß ¬°Comenzar Reparaciones!
        </button>

        <button id="toggleBtn" 
                onclick="toggleVideo()" 
                class="bg-white bg-opacity-40 hover:bg-opacity-60 text-black font-semibold px-6 py-4 rounded-lg transition">
            ‚ñ∂Ô∏è Reproducir
        </button>
    </div>
</section>



<script>
    const video = document.getElementById('bgVideo');
    const btn = document.getElementById('toggleBtn');

    function toggleVideo() {
        if (video.paused) {
            video.play();
            btn.textContent = '‚è∏Ô∏è Pausar';
        } else {
            video.pause();
            btn.textContent = '‚ñ∂Ô∏è Reproducir';
        }
    }
</script>


        <!-- Missions Section -->
        <section class="space-y-8" id="missionsSection" style="display: none;">
            <h2 class="font-cinzel text-3xl font-bold text-center mb-8">üéØ Misiones del Laboratorio</h2>
            
            <!-- Mission 1: Hardware/Software Classification -->
            <div class="mission-card bg-gradient-to-br from-red-700 to-orange-700 rounded-xl p-8 backdrop-blur-sm" id="mission1">
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <h3 class="font-bold text-3xl mb-4">üíª Misi√≥n 1: Clasificar Hardware/Software</h3>
                        <p class="mb-4 opacity-90 text-lg">
                            Los componentes del laboratorio est√°n mezclados. Debes separar correctamente los elementos 
                            de hardware (f√≠sicos) de los de software (programas). ¬°La estabilidad del sistema depende de ti!
                        </p>
                        <div class="mb-4 bg-black bg-opacity-30 rounded-lg p-4">
                            <p class="text-sm mb-2"><strong>üîó Misi√≥n Externa:</strong></p>
                            <p class="text-sm opacity-90">Completa la actividad de clasificaci√≥n en el enlace externo</p>
                            <p class="text-sm opacity-90">Al finalizar, obtendr√°s una palabra secreta</p>
                        </div>
                        <div class="mb-6">
                            <div class="text-yellow-300 text-lg mb-2">üéÅ Recompensas:</div>
                            <div class="flex gap-4">
                                <span class="bg-black bg-opacity-30 rounded px-3 py-1">üîã Bater√≠a de Energ√≠a</span>
                                <span class="bg-black bg-opacity-30 rounded px-3 py-1">+10 puntos</span>
                            </div>
                        </div>
                        <button class="mission-btn w-full bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-4 font-semibold text-lg transition-all" onclick="startExternalMission(1)">
                            üöÄ Ir a Misi√≥n Externa
                        </button>

                        <!-- Bot√≥n para abrir modal de palabra secreta -->
                        <button class="enter-secret-btn mt-4 w-full bg-yellow-600 bg-opacity-30 hover:bg-opacity-40 rounded-lg py-4 font-semibold text-lg transition-all" onclick="openSecretWordModal(1)">
                            üîë Ingresar Palabra Secreta
                        </button>

                        <div class="mt-4 text-center">
                            <span class="mission-status text-sm opacity-70" id="status1">Disponible</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-8xl mb-4">üíª</div>
                        <div class="text-3xl" id="mission1Status">‚≠ï</div>
                    </div>
                </div>
            </div>
            <!-- Mission 2: Repair Laboratory -->
            <div class="mission-card bg-gradient-to-br from-orange-700 to-red-700 rounded-xl p-8 backdrop-blur-sm" id="mission2" style="display:none;">
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <h3 class="font-bold text-3xl mb-4">üîß Misi√≥n 2: Laboratorio de Reparaciones</h3>
                        <p class="mb-4 opacity-90 text-lg">
                            Los sistemas del laboratorio han sido infectados por c√≥digo malicioso. Debes identificar 
                            las amenazas y aplicar las reparaciones necesarias para restaurar la funcionalidad completa.
                        </p>
                        <div class="mb-4 bg-black bg-opacity-30 rounded-lg p-4">
                            <p class="text-sm mb-2"><strong>üîó Misi√≥n Externa:</strong></p>
                            <p class="text-sm opacity-90">Completa la actividad de reparaci√≥n en el enlace externo</p>
                            <p class="text-sm opacity-90">Al finalizar, obtendr√°s una palabra secreta</p>
                        </div>
                        <div class="mb-6">
                            <div class="text-yellow-300 text-lg mb-2">üéÅ Recompensas:</div>
                            <div class="flex gap-4">
                                <span class="bg-black bg-opacity-30 rounded px-3 py-1">üîß Kit de Reparaci√≥n</span>
                                <span class="bg-black bg-opacity-30 rounded px-3 py-1">+10 puntos</span>
                            </div>
                        </div>
                        <button class="mission-btn w-full bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-4 font-semibold text-lg transition-all" onclick="startExternalMission(2)">
                            üöÄ Ir a Misi√≥n Externa
                        </button>

                        <!-- Bot√≥n para abrir modal de palabra secreta -->
                        <button class="enter-secret-btn mt-4 w-full bg-yellow-600 bg-opacity-30 hover:bg-opacity-40 rounded-lg py-4 font-semibold text-lg transition-all" onclick="openSecretWordModal(2)">
                            üîë Ingresar Palabra Secreta
                        </button>

                        <div class="mt-4 text-center">
                            <span class="mission-status text-sm opacity-70" id="status2">Disponible</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-8xl mb-4">üîß</div>
                        <div class="text-3xl" id="mission2Status">‚≠ï</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Learning Content -->
        <section class="mb-12" id="learningContent" style="display: none;">
            <div class="bg-black bg-opacity-40 rounded-xl p-8 backdrop-blur-sm">
                <h2 class="font-cinzel text-3xl font-bold text-center mb-8">üìö Conocimiento del Laboratorio</h2>
                
                <!-- Hardware vs Software -->
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div class="bg-blue-600 bg-opacity-30 rounded-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-blue-300">üíª HARDWARE</h3>
                        <p class="mb-4 text-sm opacity-90">Componentes f√≠sicos que puedes tocar:</p>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üñ•Ô∏è</span>
                                <span>Monitor - Pantalla para ver informaci√≥n</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">‚å®Ô∏è</span>
                                <span>Teclado - Para escribir y dar comandos</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üñ±Ô∏è</span>
                                <span>Mouse - Para navegar y seleccionar</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üîå</span>
                                <span>CPU - Cerebro de la computadora</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üíæ</span>
                                <span>Disco Duro - Almacena informaci√≥n</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üîä</span>
                                <span>Altavoces - Para escuchar sonidos</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-green-600 bg-opacity-30 rounded-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-green-300">üì± SOFTWARE</h3>
                        <p class="mb-4 text-sm opacity-90">Programas y aplicaciones digitales:</p>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üåê</span>
                                <span>Navegador Web - Para internet</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üìù</span>
                                <span>Procesador de Texto - Para escribir</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üéÆ</span>
                                <span>Videojuegos - Para entretenimiento</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üõ°Ô∏è</span>
                                <span>Antivirus - Para protecci√≥n</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üíª</span>
                                <span>Sistema Operativo - Windows, Mac, Linux</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üì±</span>
                                <span>Apps M√≥viles - Para tel√©fonos</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Quiz -->
                <div class="mb-8">
                    <h3 class="text-2xl font-bold mb-6 text-center">üß† Pon a Prueba tu Conocimiento</h3>
                    <div id="quiz1" class="space-y-6">
                        <div class="question-container">
                            <h4 class="text-xl mb-4">¬øCu√°l de estos elementos es HARDWARE?</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <button class="quiz-option bg-blue-600 bg-opacity-30 hover:bg-opacity-50 p-4 rounded-lg text-left transition-all" onclick="selectAnswer(1, 'A', true)">
                                    A) üñ•Ô∏è Monitor
                                </button>
                                <button class="quiz-option bg-blue-600 bg-opacity-30 hover:bg-opacity-50 p-4 rounded-lg text-left transition-all" onclick="selectAnswer(1, 'B', false)">
                                    B) üåê Navegador Web
                                </button>
                                <button class="quiz-option bg-blue-600 bg-opacity-30 hover:bg-opacity-50 p-4 rounded-lg text-left transition-all" onclick="selectAnswer(1, 'C', false)">
                                    C) üìù Microsoft Word
                                </button>
                                <button class="quiz-option bg-blue-600 bg-opacity-30 hover:bg-opacity-50 p-4 rounded-lg text-left transition-all" onclick="selectAnswer(1, 'D', false)">
                                    D) üéÆ Videojuego
                                </button>
                            </div>
                            <div class="answer-feedback mt-4" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button onclick="backToMissions()" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 px-8 py-4 rounded-lg font-bold text-xl transition-all">
                        ‚Üê Volver a las Misiones
                    </button>
                </div>
            </div>
        </section>

        <!-- Chapter Complete -->
        <section class="mt-12" id="chapterComplete" style="display: none;">
            <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl p-8 backdrop-blur-sm text-center">
                <h2 class="font-cinzel text-4xl font-bold mb-6">üèÜ ¬°LABORATORIO RESTAURADO!</h2>
                <div class="text-8xl mb-6">üß≠‚ú®üîß</div>
                <p class="text-2xl mb-4">¬°Excelente trabajo, Guardi√°n Digital!</p>
                <p class="text-lg mb-6 opacity-90">Has completado todas las misiones del Cap√≠tulo 1</p>
                <div class="bg-black bg-opacity-30 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-bold mb-4">üéñÔ∏è Logros Desbloqueados:</h3>
                    <div id="chapterAchievements" class="grid md:grid-cols-2 gap-4 text-sm">
                        <!-- Mantengo la estructura visual; JS puede inyectar si quieres -->
                        <div>‚úÖ Maestro del Hardware</div>
                        <div>‚úÖ Experto en Software</div>
                        <div>‚úÖ Reparador de Sistemas</div>
                        <div>‚úÖ Guardi√°n del Laboratorio</div>
                    </div>
                </div>
                <div class="bg-yellow-600 bg-opacity-30 rounded-lg p-4 mb-6">
                    <h4 class="font-bold mb-2">üõ†Ô∏è Herramientas Obtenidas:</h4>
                    <div class="flex justify-center gap-4">
                        <span class="text-2xl">üîã</span>
                        <span class="text-2xl">üîß</span>
                    </div>
                    <p class="text-sm mt-2">Bater√≠a de Energ√≠a + Kit de Reparaci√≥n</p>
                </div>
                <div class="flex justify-center gap-4">
                    <button onclick="goHome()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-3 rounded-lg font-semibold transition-all">
                        üè† Volver al Mapa
                    </button>
                    <button onclick="nextChapter()" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 px-6 py-3 rounded-lg font-semibold transition-all">
                        ‚û°Ô∏è Cap√≠tulo 2: Reino de la Nube
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Palabra Secreta (est√°tica) -->
    <div id="secretWordModal" style="display:none;" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
      <div class="bg-gradient-to-br from-yellow-600 to-orange-600 rounded-xl p-8 max-w-md w-full mx-4 text-center">
          <h2 class="font-cinzel text-3xl font-bold mb-4">üîë Palabra Secreta</h2>
          <p class="text-lg mb-4">Ingresa la palabra obtenida en la misi√≥n actual:</p>
          <div class="flex gap-4 justify-center mb-4">
              <input id="secretWordInput" type="text" maxlength="20" placeholder="Palabra secreta..." class="px-4 py-3 rounded-lg bg-black bg-opacity-30 border border-white border-opacity-30 text-white placeholder-gray-400 text-center w-2/3">
              <button onclick="validateSecretWord()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg font-semibold">‚úÖ</button>
          </div>
          <div class="flex justify-center gap-4">
            <button onclick="closeSecretWordModal()" class="text-sm opacity-80 hover:opacity-100">‚ùå Cerrar</button>
          </div>
      </div>
    </div>
    <script>
        // Game State Management (manteniendo tu estructura y claves)
        let gameState = {
            playerName: localStorage.getItem('arcanum_last_player') || '',
            points: 0,
            tools: [],
            completedMissions: [],
            currentChapter: 1,
            rouletteUnlocked: false,
            achievements: [] // <- aqu√≠ guardamos los nombres legibles
        };

        // Secret words mapping (igual que el original)
        const secretWords = {
            'SOFTWARE': { mission: 1, tool: 'battery', points: 10 },
            'MALICIOSO': { mission: 2, tool: 'repair', points: 10 },
            'COPIA': { mission: 3, tool: 'backup', points: 10 },
            'CONFIAS': { mission: 5, tool: 'compass', points: 10 },
            'EVIDENCIA': { mission: 6, tool: 'crown', points: 10 }
        };

        const roulettePrizes = [
            { name: 'Consultar Docente', emoji: 'üìû', action: 'teacher' },
            { name: 'Ayuda de Compa√±ero', emoji: 'üë•', action: 'classmate' },
            { name: '1 min en Google', emoji: 'üåê', action: 'google' },
            { name: '+10 Puntos Extra', emoji: '‚≠ê', action: 'points' },
            { name: 'Reintentar Misi√≥n', emoji: 'üîÑ', action: 'retry' },
            { name: 'Mini-reto Sorpresa', emoji: 'üé≠', action: 'challenge' }
        ];

        let currentMissionForSecret = null;

        // Map mission -> achievement name (legible)
        const achievementNamesByMission = {
            1: 'Maestro del Hardware',
            2: 'Reparador de Sistemas',
            3: 'Copia de Seguridad',
            4: 'Experto en Colaboraci√≥n',
            5: 'Br√∫jula Digital',
            6: 'Corona del Saber'
        };
        const chapterAchievement = 'Guardi√°n del Laboratorio';

        // --- Load game state (player-specific if available, otherwise general ch1 state) ---
        function loadGameState() {
            // Try player-specific data first (if we have a last player)
            let loaded = false;
            if (gameState.playerName) {
                const playerKey = `arcanum_player_${gameState.playerName.toLowerCase().replace(/\s+/g, '_')}`;
                const savedData = localStorage.getItem(playerKey);
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        applyLoadedData(data);
                        loaded = true;
                    } catch (e) { console.warn('Error parseando playerKey:', e); }
                }
            }

            // If no player-specific, try the chapter general state
            if (!loaded) {
                const savedGeneral = localStorage.getItem('arcanum_ch1_state');
                if (savedGeneral) {
                    try {
                        const data = JSON.parse(savedGeneral);
                        applyLoadedData(data);
                        loaded = true;
                    } catch (e) { console.warn('Error parseando arcanum_ch1_state:', e); }
                }
            }

            // If nothing loaded, keep defaults (no override)
            // If hubo progreso, mostrar misiones directamente (no forzar intro)
            if (gameState.completedMissions && gameState.completedMissions.length > 0) {
                document.getElementById('storyIntro').style.display = 'none';
                document.getElementById('missionsSection').style.display = 'block';
            }

            updateUI();
        }

        function applyLoadedData(data) {
            gameState.points = data.points || 0;
            gameState.tools = data.tools || [];
            gameState.completedMissions = data.completedMissions || [];
            gameState.currentChapter = data.currentChapter || 1;
            gameState.rouletteUnlocked = data.rouletteUnlocked || false;
            gameState.achievements = data.achievements || [];
        }

        // --- Save game state (both general ch1 key and player key if available) ---
        function saveGameState() {
            const dataToSave = {
                points: gameState.points,
                tools: gameState.tools,
                completedMissions: gameState.completedMissions,
                currentChapter: gameState.currentChapter,
                rouletteUnlocked: gameState.rouletteUnlocked,
                achievements: gameState.achievements,
                lastSaved: new Date().toISOString()
            };

            // Save general chapter 1 state
            localStorage.setItem('arcanum_ch1_state', JSON.stringify(dataToSave));

            // Also save under player key if we have playerName (for index compatibility)
            if (gameState.playerName) {
                const playerKey = `arcanum_player_${gameState.playerName.toLowerCase().replace(/\s+/g, '_')}`;
                localStorage.setItem(playerKey, JSON.stringify(dataToSave));
                localStorage.setItem('arcanum_last_player', gameState.playerName);
            }
        }

        // Update UI (sin cambiar tu estructura visual)
        function updateUI() {
            // Story intro / missions / chapterComplete logic
            if (gameState.completedMissions.includes(1) && gameState.completedMissions.includes(2)) {
                document.getElementById('storyIntro').style.display = "none";
                document.getElementById('chapterComplete').style.display = "block";
                document.getElementById('mission1').style.display = "none";
                document.getElementById('mission2').style.display = "none";
                document.getElementById('missionsSection').style.display = 'none';
            } else {
                if (gameState.completedMissions.length > 0) {
                    document.getElementById('storyIntro').style.display = "none";
                    document.getElementById('missionsSection').style.display = "block";
                } else {
                    document.getElementById('storyIntro').style.display = "block";
                    document.getElementById('missionsSection').style.display = "none";
                }
                document.getElementById('chapterComplete').style.display = "none";
            }

            // Mission states
            if (gameState.completedMissions.includes(1)) {
                document.getElementById('mission1Status').textContent = '‚úÖ';
                document.getElementById('status1').textContent = 'Completada';
                document.getElementById('status1').className = 'mission-status text-sm text-green-300';
                document.getElementById('mission1').style.display = "none";
                if (!gameState.completedMissions.includes(2)) {
                    document.getElementById('mission2').style.display = "block";
                }
            } else {
                document.getElementById('mission1').style.display = "block";
                if (!gameState.completedMissions.includes(1)) document.getElementById('mission2').style.display = "none";
            }

            if (gameState.completedMissions.includes(2)) {
                document.getElementById('mission2Status').textContent = '‚úÖ';
                document.getElementById('status2').textContent = 'Completada';
                document.getElementById('status2').className = 'mission-status text-sm text-green-300';
                document.getElementById('mission2').style.display = "none";
            }

            // Ocultar/mostrar botones de ingreso de palabra secreta
            const enterBtn1 = document.querySelector('#mission1 .enter-secret-btn');
            if (enterBtn1) enterBtn1.style.display = gameState.completedMissions.includes(1) ? 'none' : 'block';
            const enterBtn2 = document.querySelector('#mission2 .enter-secret-btn');
            if (enterBtn2) enterBtn2.style.display = gameState.completedMissions.includes(2) ? 'none' : 'block';

            // Puntos y herramientas visibles
            document.getElementById('points').textContent = gameState.points;
            document.getElementById('toolCount').textContent = `${gameState.tools.length}/6`;

            // Opcional: si quieres mostrar din√°micamente achievements en el di√°logo de cap√≠tulo completo,
            // podemos inyectarlos en #chapterAchievements ‚Äî lo dejo comentado por si lo quieres.
            // renderChapterAchievements();

            updateRouletteStatus();
        }

        // (opcional) render achievements inside chapterComplete block if visible
        function renderChapterAchievements() {
            const container = document.getElementById('chapterAchievements');
            if (!container) return;
            container.innerHTML = '';
            if (gameState.achievements && gameState.achievements.length > 0) {
                gameState.achievements.forEach(a => {
                    const div = document.createElement('div');
                    div.textContent = `‚úÖ ${a}`;
                    container.appendChild(div);
                });
            } else {
                // default placeholders to keep layout
                container.innerHTML = `
                  <div>‚Äî</div><div>‚Äî</div><div>‚Äî</div><div>‚Äî</div>
                `;
            }
        }

        // Update roulette status
        function updateRouletteStatus() {
            const spinBtn = document.getElementById('spinRouletteBtn');
            const status = document.getElementById('rouletteStatus');
            
            if (gameState.points >= 20) {
                gameState.rouletteUnlocked = true;
                spinBtn.disabled = gameState.points < 10;
                status.textContent = gameState.points >= 10 ? 'Disponible' : 'Necesitas 10 puntos';
            } else {
                spinBtn.disabled = true;
                status.textContent = 'Requiere 20 puntos';
            }
        }

        // Start chapter
        function startChapter() {
            document.getElementById('storyIntro').style.display = 'none';
            document.getElementById('missionsSection').style.display = 'block';
        }

        // Start external mission
        function startExternalMission(missionNum) {
            if (missionNum === 1) {
                showModal('Misi√≥n Externa', 'Ser√°s redirigido a la actividad de clasificaci√≥n Hardware/Software. Al completarla, obtendr√°s la palabra secreta', 'üöÄ Ir a Misi√≥n', () => {
                    window.open('https://view.genially.com/68c9819b061f58e1fbf7092c/interactive-content-clasifica-los-elementos-hardware-o-software', '_blank');
                });
            } else if (missionNum === 2) {
                showModal('Misi√≥n Externa', 'Ser√°s redirigido al Laboratorio de Reparaciones. Al completarla, obtendr√°s la palabra secreta', 'üöÄ Ir a Misi√≥n', () => {
                    window.open('https://wayground.com/admin/quiz/68c9997045e9a76de28f2726/reto-2-el-laboratorio-de-reparaciones', '_blank');
                });
            }
        }

        // Show learning content
        function showLearning() {
            document.getElementById('missionsSection').style.display = 'none';
            document.getElementById('learningContent').style.display = 'block';
        }

        // Back to missions
        function backToMissions() {
            document.getElementById('learningContent').style.display = 'none';
            document.getElementById('missionsSection').style.display = 'block';
        }

        // ---- Modal de palabra secreta (abrir / cerrar) ----
        function openSecretWordModal(missionNum) {
            currentMissionForSecret = missionNum;
            document.getElementById('secretWordInput').value = '';
            document.getElementById('secretWordModal').style.display = 'flex';
        }

        function closeSecretWordModal() {
            document.getElementById('secretWordModal').style.display = 'none';
            currentMissionForSecret = null;
        }

        // Validate secret word
        function validateSecretWord() {
            const word = document.getElementById('secretWordInput').value.toUpperCase().trim();

            if (!word) {
                showModal('Palabra Vac√≠a', 'Ingresa una palabra secreta antes de validar.', 'üîÑ Intentar');
                return;
            }

            if (secretWords[word]) {
                const wordData = secretWords[word];
                
                if (gameState.completedMissions.includes(wordData.mission)) {
                    showModal('Palabra Ya Usada', 'Esta palabra secreta ya fue utilizada anteriormente.', 'üîÑ Intentar Otra');
                    return;
                }

                if (currentMissionForSecret !== wordData.mission) {
                    showModal('Palabra Incorrecta', 'Esta palabra no corresponde a la misi√≥n actual.', 'üîÑ Intentar Otra');
                    return;
                }
                
                // Complete mission
                gameState.completedMissions.push(wordData.mission);
                gameState.points += wordData.points;
                gameState.tools.push(wordData.tool);

                // A√±adimos logro legible por misi√≥n
                const achName = achievementNamesByMission[wordData.mission];
                if (achName && !gameState.achievements.includes(achName)) {
                    gameState.achievements.push(achName);
                }

                // Si complet√≥ ambas misiones 1 y 2, a√±adimos logro de cap√≠tulo
                if (gameState.completedMissions.includes(1) && gameState.completedMissions.includes(2)) {
                    if (!gameState.achievements.includes(chapterAchievement)) {
                        gameState.achievements.push(chapterAchievement);
                    }
                }
                
const toolName = wordData.tool === 'battery' ? 'Bater√≠a de Energ√≠a' : 'Kit de Reparaci√≥n';
const toolEmoji = wordData.tool === 'battery' ? 'üîã' : 'üîß';

// Crear contenido del modal
const modalContent = document.createElement('div');
modalContent.style.textAlign = 'center'; // Centrar todo el contenido

// Mensaje principal
const message = document.createElement('p');
message.innerHTML = `¬°Excelente! Has completado la misi√≥n y obtenido ${toolEmoji} ${toolName} (+${wordData.points} puntos)`;
modalContent.appendChild(message);

// Imagen de la tarjeta
const img = document.createElement('img');
img.style.width = '500px';
img.style.marginTop = '50px';

if(wordData.tool === 'battery') {
    img.src = '1.jpg';
    img.alt = 'Bater√≠a de Energ√≠a';
} else if(wordData.tool === 'repair') {
    img.src = '2.jpg';
    img.alt = 'Kit de Reparaci√≥n';
}

modalContent.appendChild(img);

// Texto debajo de la imagen
const cardText = document.createElement('p');
cardText.innerHTML = '¬°Obtuviste una tarjeta de colecci√≥n!';
cardText.style.marginTop = '20px';
cardText.style.fontWeight = 'bold';
modalContent.appendChild(cardText);

// Mostrar modal
showModal('¬°Misi√≥n Completada!', modalContent.outerHTML, 'üéâ ¬°Genial!');

// Limpiar input
document.getElementById('secretWordInput').value = '';

                saveGameState();
                updateUI();

                // Desbloquear Misi√≥n 2 si se complet√≥ la 1 (updateUI ya se encarga)
                closeSecretWordModal();
                
            } else {
                showModal('Palabra Incorrecta', 'La palabra secreta no es v√°lida. Verifica que hayas completado correctamente la misi√≥n externa.', 'üîÑ Intentar Otra');
            }
        }

        // Spin roulette
        function spinRoulette() {
            if (gameState.points < 10) return;
            
            gameState.points -= 10;
            
            const wheel = document.getElementById('rouletteWheel');
            wheel.classList.add('roulette-wheel');
            
            setTimeout(() => {
                const prize = roulettePrizes[Math.floor(Math.random() * roulettePrizes.length)];
                
                if (prize.action === 'points') {
                    gameState.points += 10;
                    showModal('¬°Premio de la Ruleta!', `¬°Has ganado ${prize.emoji} ${prize.name}!`, 'üéâ ¬°Genial!');
                } else {
                    showModal('¬°Premio de la Ruleta!', `¬°Has ganado ${prize.emoji} ${prize.name}! Puedes usarlo cuando lo necesites.`, 'üéâ ¬°Genial!');
                }
                
                wheel.classList.remove('roulette-wheel');
                saveGameState();
                updateUI();
            }, 4000);
        }

        // Select quiz answer
        function selectAnswer(questionNum, option, isCorrect) {
            const buttons = document.querySelectorAll(`#quiz${questionNum} .quiz-option`);
            const feedback = document.querySelector(`#quiz${questionNum} .answer-feedback`);
            
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.trim().startsWith(option)) {
                    if (isCorrect) {
                        btn.classList.add('correct');
                    } else {
                        btn.classList.add('incorrect');
                    }
                }
            });
            
            if (isCorrect) {
                feedback.innerHTML = '<div class="text-green-300 font-bold">¬°Correcto! El monitor es un componente f√≠sico (hardware) üéâ</div>';
                gameState.points += 5;
                saveGameState();
                updateUI();
            } else {
                feedback.innerHTML = '<div class="text-red-300 font-bold">Incorrecto. El monitor es hardware porque es f√≠sico. ü§î</div>';
                setTimeout(() => {
                    buttons.forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('incorrect');
                    });
                    feedback.style.display = 'none';
                }, 3000);
            }
            
            feedback.style.display = 'block';
        }

        // Navigation functions
        function goHome() {
            window.location.href = 'index.html';
        }

        function nextChapter() {
            window.location.href = 'capitulo2.html';
        }

        // Show modal (gen√©rico, reutilizable)
        function showModal(title, message, buttonText = '‚ú® Continuar', callback = null) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gradient-to-br from-purple-800 to-blue-800 rounded-xl p-8 max-w-md w-full mx-4 text-center">
                    <h2 class="font-cinzel text-2xl font-bold mb-4">${title}</h2>
                    <p class="text-lg mb-6">${message}</p>
                    <button class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-3 rounded-lg font-semibold transition-all modal-ok">
                        ${buttonText}
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            const okBtn = modal.querySelector('.modal-ok');
            okBtn.addEventListener('click', () => {
                modal.remove();
                if (typeof callback === 'function') callback();
            });
        }

        // Initialize
        loadGameState();
        
        // Show learning button in missions and set initial displays (without overriding saved state)
        document.addEventListener('DOMContentLoaded', function() {
            const missionsSection = document.getElementById('missionsSection');
            if (missionsSection) {
                const learningButton = document.createElement('div');
                learningButton.className = 'text-center mt-8';
                learningButton.innerHTML = `
                    <button onclick="showLearning()" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 px-6 py-3 rounded-lg font-semibold transition-all">
                        üìö Ver Contenido Educativo
                    </button>
                `;
                missionsSection.appendChild(learningButton);
            }

            // Solo forzamos estado inicial si NO hay progreso guardado
            if (!gameState.completedMissions || gameState.completedMissions.length === 0) {
                document.getElementById('storyIntro').style.display = 'block';
                document.getElementById('missionsSection').style.display = 'none';
                document.getElementById('learningContent').style.display = 'none';
                document.getElementById('chapterComplete').style.display = 'none';
                document.getElementById('mission2').style.display = 'none';
            } else {
                // Si hay progreso, updateUI ya se encarg√≥ de mostrar la secci√≥n correcta
                document.getElementById('learningContent').style.display = 'none';
                document.getElementById('chapterComplete').style.display = 'none';
            }
        });
    </script>

<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980a6b830566b4e0',t:'MTc1ODEzMTE1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>