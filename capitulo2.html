
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CapÃ­tulo 2: El Reino de la Nube - Arcanum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap');
        
        .fantasy-bg {
            background: linear-gradient(135deg, #0c4a6e 0%, #2563eb 50%, #3b82f6 100%);
            position: relative;
        }
        
        .fantasy-bg::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }
        
        .magical-glow {
            animation: glow 3s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 40px rgba(37, 99, 235, 0.5); }
        }
        
        .mission-card {
            transition: all 0.3s ease;
        }
        
        .mission-card:hover {
            transform: translateY(-5px);
        }
        
        .component-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .quiz-option {
            transition: all 0.3s ease;
        }
        
        .quiz-option:hover {
            transform: scale(1.02);
        }
        
        .correct {
            background: linear-gradient(135deg, #059669, #10b981) !important;
            animation: correctPulse 0.5s ease;
        }
        
        .incorrect {
            background: linear-gradient(135deg, #dc2626, #ef4444) !important;
            animation: shake 0.5s ease;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .roulette-wheel {
            animation: spin 4s ease-in-out;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(1440deg); }
        }
    </style>
</head>
<body class="fantasy-bg min-h-screen text-white font-inter">
    <!-- Header -->
    <header class="relative z-10 p-6">
        <div class="flex justify-between items-center">
            <button onclick="goHome()" class="bg-black bg-opacity-30 hover:bg-opacity-50 rounded-lg px-4 py-2 transition-all">
                â† Volver al Mapa
            </button>
            <div class="text-center">
                <h1 class="font-cinzel text-3xl font-bold magical-glow">â˜ï¸ El Reino de la Nube</h1>
                <p class="text-lg opacity-90">CapÃ­tulo 2 - Fundamentos Digitales</p>
            </div>
            <div class="flex gap-4">
                <div class="bg-black bg-opacity-30 rounded-lg px-4 py-2 text-center">
                    <div class="text-lg font-bold text-yellow-300" id="points">0</div>
                    <div class="text-xs opacity-80">Puntos</div>
                </div>
                <div class="bg-black bg-opacity-30 rounded-lg px-4 py-2 text-center">
                    <div class="text-lg font-bold text-green-300" id="toolCount">0/6</div>
                    <div class="text-xs opacity-80">Herramientas</div>
                </div>
            </div>
        </div>

    </header>

    <!-- Ruleta del Destino -->
    <section class="relative z-10 max-w-4xl mx-auto px-6 mb-8">
        <div class="bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl p-6 backdrop-blur-sm text-center">
            <h2 class="font-cinzel text-2xl font-bold mb-4">ğŸ° Ruleta del Destino</h2>
            <div class="flex items-center justify-center gap-6">
                <div class="text-4xl" id="rouletteWheel">ğŸ¯</div>
                <div>
                    <p class="text-sm opacity-90 mb-2">Gira para obtener ayudas especiales</p>
                    <button id="spinRouletteBtn" onclick="spinRoulette()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg font-semibold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ğŸ° Girar (10 pts)
                    </button>
                </div>
                <div class="text-xs opacity-70" id="rouletteStatus">Requiere 20 puntos</div>
            </div>
        </div>
    </section>
    <!-- Main Content -->
    <main class="relative z-10 max-w-6xl mx-auto px-6 pb-12">
        
        <!-- Story Introduction -->
        <section class="mb-12" id="storyIntro">
            <div class="bg-black bg-opacity-40 rounded-xl p-8 backdrop-blur-sm text-center">
                <div class="component-animation text-8xl mb-6">â˜ï¸</div>
                <h2 class="font-cinzel text-4xl font-bold mb-6">Â¡Bienvenido al Reino de la Nube!</h2>
                <p class="text-xl leading-relaxed max-w-4xl mx-auto mb-8 opacity-90">
                    Has llegado al mÃ­stico Reino de la Nube, donde los datos flotan libremente y la colaboraciÃ³n es la clave del poder. AquÃ­ aprenderÃ¡s los secretos del almacenamiento en la nube y el trabajo colaborativo.
                </p>

                <div class="bg-blue-600 bg-opacity-30 rounded-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-4">ğŸ”® MISIÃ“N 3: El OrÃ¡culo de la Nube</h3>
                    <p class="text-lg mb-4">
                        Consulta al sabio OrÃ¡culo para aprender sobre el almacenamiento en la nube y sus misterios.
                    </p>
                    <div class="mb-4">
                        <div class="text-yellow-300 text-lg mb-2">ğŸ Recompensa:</div>
                        <div class="flex gap-4">
                            <span class="bg-black bg-opacity-30 rounded px-3 py-1">ğŸ’¾ Copia de Seguridad</span>
                            <span class="bg-black bg-opacity-30 rounded px-3 py-1">+10 puntos</span>
                        </div>
                    </div>
                    <button class="mission-btn w-full bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-4 font-semibold text-lg transition-all" onclick="startExternalMission(3)">
                        ğŸš€ Ir a MisiÃ³n Externa
                    </button>
                    <!-- BotÃ³n para abrir modal de palabra secreta -->
                    <button class="enter-secret-btn mt-4 w-full bg-yellow-600 bg-opacity-30 hover:bg-opacity-40 rounded-lg py-4 font-semibold text-lg transition-all" onclick="openSecretWordModal(3)">
                        ğŸ”‘ Ingresar Palabra Secreta
                    </button>
                    <div class="mt-4 text-center">
                        <span class="mission-status text-sm opacity-70" id="status3">Disponible</span>
                    </div>
                </div>

                <div class="bg-green-600 bg-opacity-30 rounded-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-4">ğŸ¤ MISIÃ“N 4: Pizarra Colaborativa</h3>
                    <p class="text-lg mb-4">
                        Domina el arte del trabajo colaborativo usando herramientas digitales en la nube.
                    </p>
                    <div class="mb-4">
                        <div class="text-yellow-300 text-lg mb-2">ğŸ Recompensa:</div>
                        <div class="flex gap-4">
                            <span class="bg-black bg-opacity-30 rounded px-3 py-1">ğŸ¤ Trabajo en Equipo</span>
                            <span class="bg-black bg-opacity-30 rounded px-3 py-1">Acceso Libre</span>
                        </div>
                    </div>
                    <button class="mission-btn w-full bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-4 font-semibold text-lg transition-all" onclick="startExternalMission(4)">
                        ğŸš€ Ir a MisiÃ³n Externa
                    </button>
                    <!-- No hay palabra secreta para esta misiÃ³n -->
                    <div class="mt-4 text-center">
                        <span class="mission-status text-sm opacity-70" id="status4">Disponible</span>
                    </div>
                </div>

                <button onclick="startChapter()" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 px-8 py-4 rounded-lg font-bold text-xl transition-all">
                    â˜ï¸ Â¡Comenzar Aventuras en la Nube!
                </button>
            </div>
        </section>

        <!-- Missions Section -->
        <section class="space-y-8" id="missionsSection" style="display: none;">
            <h2 class="font-cinzel text-3xl font-bold text-center mb-8">ğŸ¯ Misiones del Reino de la Nube</h2>
                                             <!-- Video debajo del tÃ­tulo -->
<div class="max-w-3xl mx-auto rounded-lg overflow-hidden shadow-lg">
    <video id="nubeVideo" class="w-full h-64 object-cover rounded-lg" controls preload="auto">
        <source src="nube.mp4" type="video/mp4">
        Tu navegador no soporta video en HTML5.
    </video>
</div>
            <!-- Mission 3: El OrÃ¡culo de la Nube -->
            <div class="mission-card bg-gradient-to-br from-blue-700 to-cyan-700 rounded-xl p-8 backdrop-blur-sm" id="mission3">
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <h3 class="font-bold text-3xl mb-4">ğŸ”® MisiÃ³n 3: El OrÃ¡culo de la Nube</h3>
                        <p class="mb-4 opacity-90 text-lg">
                            Consulta al sabio OrÃ¡culo para aprender sobre el almacenamiento en la nube y sus misterios.
                        </p>
                        <div class="mb-4 bg-black bg-opacity-30 rounded-lg p-4">
                            <p class="text-sm mb-2"><strong>ğŸ”— MisiÃ³n Externa:</strong></p>
                            <p class="text-sm opacity-90">Completa la actividad en el enlace externo</p>
                            <p class="text-sm opacity-90">Al finalizar, obtendrÃ¡s una palabra secreta</p>
                        </div>
                        <div class="mb-6">
                            <div class="text-yellow-300 text-lg mb-2">ğŸ Recompensas:</div>
                            <div class="flex gap-4">
                                <span class="bg-black bg-opacity-30 rounded px-3 py-1">ğŸ’¾ Copia de Seguridad</span>
                                <span class="bg-black bg-opacity-30 rounded px-3 py-1">+10 puntos</span>
                            </div>
                        </div>
                        <button class="mission-btn w-full bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-4 font-semibold text-lg transition-all" onclick="startExternalMission(3)">
                            ğŸš€ Ir a MisiÃ³n Externa
                        </button>

                        <!-- BotÃ³n para abrir modal de palabra secreta -->
                        <button class="enter-secret-btn mt-4 w-full bg-yellow-600 bg-opacity-30 hover:bg-opacity-40 rounded-lg py-4 font-semibold text-lg transition-all" onclick="openSecretWordModal(3)">
                            ğŸ”‘ Ingresar Palabra Secreta
                        </button>

                        <div class="mt-4 text-center">
                            <span class="mission-status text-sm opacity-70" id="status3">Disponible</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-8xl mb-4">ğŸ”®</div>
                        <div class="text-3xl" id="mission3Status">â­•</div>
                    </div>
                </div>
            </div>

            <!-- Mission 4: Pizarra Colaborativa -->
            <div class="mission-card bg-gradient-to-br from-cyan-700 to-blue-700 rounded-xl p-8 backdrop-blur-sm" id="mission4">
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <h3 class="font-bold text-3xl mb-4">ğŸ¤ MisiÃ³n 4: Pizarra Colaborativa</h3>
                        <p class="mb-4 opacity-90 text-lg">
                            Domina el arte del trabajo colaborativo usando herramientas digitales en la nube.
                        </p>
                        <div class="mb-4 bg-black bg-opacity-30 rounded-lg p-4">
                            <p class="text-sm mb-2"><strong>ğŸ”— MisiÃ³n Externa:</strong></p>
                            <p class="text-sm opacity-90">Acceso libre sin palabra secreta</p>
                        </div>
                        <div class="mb-6">
                            <div class="text-yellow-300 text-lg mb-2">ğŸ Recompensas:</div>
                            <div class="flex gap-4">
                                <span class="bg-black bg-opacity-30 rounded px-3 py-1">ğŸ¤ Trabajo en Equipo</span>
                                <span class="bg-black bg-opacity-30 rounded px-3 py-1">Acceso Libre</span>
                            </div>
                        </div>
                        <button class="mission-btn w-full bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-4 font-semibold text-lg transition-all" onclick="startExternalMission(4)">
                            ğŸš€ Ir a MisiÃ³n Externa
                        </button>

                        <!-- No hay palabra secreta para esta misiÃ³n, ocultamos botÃ³n -->
                        <div class="mt-4 text-center">
                            <span class="mission-status text-sm opacity-70" id="status4">Disponible</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-8xl mb-4">ğŸ¤</div>
                        <div class="text-3xl" id="mission4Status">â­•</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Learning Content -->
        <section class="mb-12" id="learningContent" style="display: none;">
            <div class="bg-black bg-opacity-40 rounded-xl p-8 backdrop-blur-sm">
                <h2 class="font-cinzel text-3xl font-bold text-center mb-8">ğŸ“š Conocimiento del Reino de la Nube</h2>
                
                <!-- Cloud Storage and Collaboration -->
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div class="bg-blue-600 bg-opacity-30 rounded-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-blue-300">â˜ï¸ Almacenamiento en la Nube</h3>
                        <p class="mb-4 text-sm opacity-90">Guardar datos en servidores remotos accesibles desde cualquier lugar:</p>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">ğŸ’¾</span>
                                <span>Copia de Seguridad - Protege tus datos</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">ğŸ“‚</span>
                                <span>Carpetas Compartidas - Acceso colaborativo</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">ğŸ”</span>
                                <span>Seguridad - Control de acceso y privacidad</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-green-600 bg-opacity-30 rounded-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-green-300">ğŸ¤ Trabajo Colaborativo</h3>
                        <p class="mb-4 text-sm opacity-90">Herramientas digitales para colaborar en tiempo real:</p>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">ğŸ“</span>
                                <span>Documentos Compartidos - EdiciÃ³n simultÃ¡nea</span>
                           </div>
                        </div>
        </div>
    </section>
    <!-- Chapter Complete -->
    <section class="mt-12" id="chapterComplete" style="display: none;">
        <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl p-8 backdrop-blur-sm text-center">
            <h2 class="font-cinzel text-4xl font-bold mb-6">ğŸ† Â¡REINO DE LA NUBE RESTAURADO!</h2>
            <div class="text-8xl mb-6">â˜ï¸âœ¨ğŸ¤</div>
            <p class="text-2xl mb-4">Â¡Excelente trabajo, GuardiÃ¡n Digital!</p>
            <p class="text-lg mb-6 opacity-90">Has completado todas las misiones del CapÃ­tulo 2</p>
            <div class="bg-black bg-opacity-30 rounded-lg p-6 mb-6">
                <h3 class="text-xl font-bold mb-4">ğŸ–ï¸ Logros Desbloqueados:</h3>
                <div id="chapterAchievements" class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>âœ… Copia de Seguridad</div>
                    <div>âœ… Experto en ColaboraciÃ³n</div>
                    <div>âœ… GuardiÃ¡n del Reino de la Nube</div>
                </div>
            </div>
            <div class="bg-yellow-600 bg-opacity-30 rounded-lg p-4 mb-6">
                <h4 class="font-bold mb-2">ğŸ› ï¸ Herramientas Obtenidas:</h4>
                <div class="flex justify-center gap-4">
                    <span class="text-2xl">ğŸ’¾</span>
                    <span class="text-2xl">ğŸ¤</span>
                </div>
                <p class="text-sm mt-2">Copia de Seguridad + Trabajo en Equipo</p>
            </div>
            <div class="flex justify-center gap-4">
                <button onclick="goHome()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-3 rounded-lg font-semibold transition-all">
                    ğŸ  Volver al Mapa
                </button>
                <button onclick="nextChapter()" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 px-6 py-3 rounded-lg font-semibold transition-all">
                    â¡ï¸ CapÃ­tulo 3: El Camino de la InformaciÃ³n
                </button>
            </div>
        </div>
    </section>
</main>

<!-- Modal Palabra Secreta (estÃ¡tica) -->
<div id="secretWordModal" style="display:none;" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
  <div class="bg-gradient-to-br from-yellow-600 to-orange-600 rounded-xl p-8 max-w-md w-full mx-4 text-center">
      <h2 class="font-cinzel text-3xl font-bold mb-4">ğŸ”‘ Palabra Secreta</h2>
      <p class="text-lg mb-4">Ingresa la palabra obtenida en la misiÃ³n actual:</p>
      <div class="flex gap-4 justify-center mb-4">
          <input id="secretWordInput" type="text" maxlength="20" placeholder="Palabra secreta..." class="px-4 py-3 rounded-lg bg-black bg-opacity-30 border border-white border-opacity-30 text-white placeholder-gray-400 text-center w-2/3">
          <button onclick="validateSecretWord()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-3 rounded-lg font-semibold">âœ…</button>
      </div>
      <div class="flex justify-center gap-4">
        <button onclick="closeSecretWordModal()" class="text-sm opacity-80 hover:opacity-100">âŒ Cerrar</button>
      </div>
  </div>
</div>

<script>
    // Estado del juego para CapÃ­tulo 2
    let gameState = {
        playerName: localStorage.getItem('arcanum_last_player') || '',
        points: 0,
        tools: [],
        completedMissions: [],
        currentChapter: 2,
        rouletteUnlocked: false,
        achievements: []
    };

    // Palabras secretas para capÃ­tulo 2
    const secretWords = {
        'COPIA': { mission: 3, tool: 'backup', points: 10 }
        // MisiÃ³n 4 no tiene palabra secreta
    };

    const roulettePrizes = [
        { name: 'Consultar Docente', emoji: 'ğŸ“', action: 'teacher' },
        { name: 'Ayuda de CompaÃ±ero', emoji: 'ğŸ‘¥', action: 'classmate' },
        { name: '1 min en Google', emoji: 'ğŸŒ', action: 'google' },
        { name: '+10 Puntos Extra', emoji: 'â­', action: 'points' },
        { name: 'Reintentar MisiÃ³n', emoji: 'ğŸ”„', action: 'retry' },
        { name: 'Mini-reto Sorpresa', emoji: 'ğŸ­', action: 'challenge' }
    ];

    let currentMissionForSecret = null;

    // Mapear misiÃ³n a nombre de logro legible
    const achievementNamesByMission = {
        3: 'Copia de Seguridad',
        4: 'Experto en ColaboraciÃ³n'
    };
    const chapterAchievement = 'GuardiÃ¡n del Reino de la Nube';
    // Cargar estado guardado
    function loadGameState() {
        let loaded = false;
        if (gameState.playerName) {
            const playerKey = `arcanum_player_${gameState.playerName.toLowerCase().replace(/\s+/g, '_')}`;
            const savedData = localStorage.getItem(playerKey);
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    applyLoadedData(data);
                    loaded = true;
                } catch (e) { console.warn('Error parseando playerKey:', e); }
            }
        }
        if (!loaded) {
            const savedGeneral = localStorage.getItem('arcanum_ch2_state');
            if (savedGeneral) {
                try {
                    const data = JSON.parse(savedGeneral);
                    applyLoadedData(data);
                    loaded = true;
                } catch (e) { console.warn('Error parseando arcanum_ch2_state:', e); }
            }
        }
        updateUI();
    }

    function applyLoadedData(data) {
        gameState.points = data.points || 0;
        gameState.tools = data.tools || [];
        gameState.completedMissions = data.completedMissions || [];
        gameState.currentChapter = data.currentChapter || 2;
        gameState.rouletteUnlocked = data.rouletteUnlocked || false;
        gameState.achievements = data.achievements || [];
    }

    // Guardar estado
    function saveGameState() {
        const dataToSave = {
            points: gameState.points,
            tools: gameState.tools,
            completedMissions: gameState.completedMissions,
            currentChapter: gameState.currentChapter,
            rouletteUnlocked: gameState.rouletteUnlocked,
            achievements: gameState.achievements,
            lastSaved: new Date().toISOString()
        };
        localStorage.setItem('arcanum_ch2_state', JSON.stringify(dataToSave));
        if (gameState.playerName) {
            const playerKey = `arcanum_player_${gameState.playerName.toLowerCase().replace(/\s+/g, '_')}`;
            localStorage.setItem(playerKey, JSON.stringify(dataToSave));
            localStorage.setItem('arcanum_last_player', gameState.playerName);
        }
    }

    // Actualizar UI con lÃ³gica para mostrar misiÃ³n 3 primero, luego misiÃ³n 4
    function updateUI() {
        if (gameState.completedMissions.includes(3) && gameState.completedMissions.includes(4)) {
            // Ambas misiones completadas: mostrar capÃ­tulo completado
            document.getElementById('storyIntro').style.display = "none";
            document.getElementById('chapterComplete').style.display = "block";
            document.getElementById('mission3').style.display = "none";
            document.getElementById('mission4').style.display = "none";
            document.getElementById('missionsSection').style.display = 'none';
        } else if (gameState.completedMissions.includes(3)) {
            // MisiÃ³n 3 completada, mostrar MisiÃ³n 4
            document.getElementById('storyIntro').style.display = "none";
            document.getElementById('missionsSection').style.display = "block";
            document.getElementById('mission3').style.display = "none";
            document.getElementById('mission4').style.display = "block";
        } else {
            // MisiÃ³n 3 no completada, mostrar solo MisiÃ³n 3
            document.getElementById('storyIntro').style.display = "none";
            document.getElementById('missionsSection').style.display = "block";
            document.getElementById('mission3').style.display = "block";
            document.getElementById('mission4').style.display = "none";
        }

        // Actualizar estados visuales de misiones
        if (gameState.completedMissions.includes(3)) {
            document.getElementById('mission3Status').textContent = 'âœ…';
            document.getElementById('status3').textContent = 'Completada';
            document.getElementById('status3').className = 'mission-status text-sm text-green-300';
        } else {
            document.getElementById('mission3Status').textContent = 'â­•';
            document.getElementById('status3').textContent = 'Disponible';
            document.getElementById('status3').className = 'mission-status text-sm opacity-70';
        }

        if (gameState.completedMissions.includes(4)) {
            document.getElementById('mission4Status').textContent = 'âœ…';
            document.getElementById('status4').textContent = 'Completada';
            document.getElementById('status4').className = 'mission-status text-sm text-green-300';
        } else {
            document.getElementById('mission4Status').textContent = 'â­•';
            document.getElementById('status4').textContent = 'Disponible';
            document.getElementById('status4').className = 'mission-status text-sm opacity-70';
        }

        // Ocultar botÃ³n palabra secreta para misiÃ³n 4 (no tiene)
        const enterBtn3 = document.querySelector('#mission3 .enter-secret-btn');
        if (enterBtn3) enterBtn3.style.display = gameState.completedMissions.includes(3) ? 'none' : 'block';
        const enterBtn4 = document.querySelector('#mission4 .enter-secret-btn');
        if (enterBtn4) enterBtn4.style.display = 'none';

        document.getElementById('points').textContent = gameState.points;
        document.getElementById('toolCount').textContent = `${gameState.tools.length}/6`;

        updateRouletteStatus();
    }

    // Actualizar estado ruleta
    function updateRouletteStatus() {
        const spinBtn = document.getElementById('spinRouletteBtn');
        const status = document.getElementById('rouletteStatus');
        
        if (gameState.points >= 20) {
            gameState.rouletteUnlocked = true;
            spinBtn.disabled = gameState.points < 10;
            status.textContent = gameState.points >= 10 ? 'Disponible' : 'Necesitas 10 puntos';
        } else {
            spinBtn.disabled = true;
            status.textContent = 'Requiere 20 puntos';
        }
    }

    // Iniciar capÃ­tulo
    function startChapter() {
        document.getElementById('storyIntro').style.display = 'none';
        document.getElementById('missionsSection').style.display = 'block';
    }
const missionTools = {
    3: { tool: 'backup', points: 10, name: 'Copia de Seguridad', emoji: 'ğŸ’¾' },
    4: { tool: 'teamwork', points: 0, name: 'Trabajo en Equipo', emoji: 'ğŸ¤' }
};
function startExternalMission(missionNum) {
    if (missionNum === 3) {
        showModal('MisiÃ³n Externa', 'SerÃ¡s redirigido a la actividad del OrÃ¡culo de la Nube. Al completarla, obtendrÃ¡s la palabra secreta', 'ğŸš€ Ir a MisiÃ³n', () => {
            window.open('https://view.genially.com/68c9a6680a2217719b7446e6/interactive-content-el-oraculo-de-la-nube', '_blank');
        });
    } else if (missionNum === 4) {
    if (!gameState.completedMissions.includes(4)) {
        gameState.completedMissions.push(4);

        // AÃ±adir herramienta para misiÃ³n 4
        const toolData = missionTools[4];
        if (toolData && !gameState.tools.includes(toolData.tool)) {
            gameState.tools.push(toolData.tool);
        }

        // AÃ±adir logro legible para misiÃ³n 4
        const achName = achievementNamesByMission[4];
        if (achName && !gameState.achievements.includes(achName)) {
            gameState.achievements.push(achName);
        }

        saveGameState();
        updateUI();

        // Crear contenido del modal con imagen
        const modalContent = document.createElement('div');
        modalContent.style.textAlign = 'center';

        const message = document.createElement('p');
        message.innerHTML = `Has obtenido ${toolData.emoji} ${toolData.name}`;
        modalContent.appendChild(message);

        // Imagen de la misiÃ³n 4
        const img = document.createElement('img');
        img.src = '4.jpg';
        img.alt = toolData.name;
        img.style.width = '500px';
        img.style.marginTop = '30px';
        img.style.display = 'block';
        img.style.marginLeft = 'auto';
        img.style.marginRight = 'auto';
        modalContent.appendChild(img);

        // Texto de tarjeta de colecciÃ³n
        const cardText = document.createElement('p');
        cardText.innerHTML = 'Â¡Obtuviste una tarjeta de colecciÃ³n!';
        cardText.style.textAlign = 'center';
        cardText.style.marginTop = '20px';
        cardText.style.fontWeight = 'bold';
        modalContent.appendChild(cardText);

        // Mostrar modal
        showModal('Â¡MisiÃ³n Completada!', modalContent.outerHTML, 'ğŸ‰ Â¡Genial!');
    }

    // Modal de redirecciÃ³n a pizarra
    showModal('MisiÃ³n Externa', 'SerÃ¡s redirigido a la Pizarra Colaborativa. Acceso libre sin palabra secreta.', 'ğŸš€ Ir a MisiÃ³n', () => {
        window.open('https://skribbl.io/?iUCSY6Nf', '_blank');
    });
}

}

    // Mostrar contenido educativo
    function showLearning() {
        document.getElementById('missionsSection').style.display = 'none';
        document.getElementById('learningContent').style.display = 'block';
    }

    // Volver a misiones
    function backToMissions() {
        document.getElementById('learningContent').style.display = 'none';
        document.getElementById('missionsSection').style.display = 'block';
    }

    // Modal palabra secreta
    function openSecretWordModal(missionNum) {
        currentMissionForSecret = missionNum;
        document.getElementById('secretWordInput').value = '';
        document.getElementById('secretWordModal').style.display = 'flex';
    }

    function closeSecretWordModal() {
        document.getElementById('secretWordModal').style.display = 'none';
        currentMissionForSecret = null;
    }

    // Validar palabra secreta
    function validateSecretWord() {
        const word = document.getElementById('secretWordInput').value.toUpperCase().trim();

        if (!word) {
            showModal('Palabra VacÃ­a', 'Ingresa una palabra secreta antes de validar.', 'ğŸ”„ Intentar');
            return;
        }

        if (secretWords[word]) {
            const wordData = secretWords[word];
            
            if (gameState.completedMissions.includes(wordData.mission)) {
                showModal('Palabra Ya Usada', 'Esta palabra secreta ya fue utilizada anteriormente.', 'ğŸ”„ Intentar Otra');
                return;
            }

            if (currentMissionForSecret !== wordData.mission) {
                showModal('Palabra Incorrecta', 'Esta palabra no corresponde a la misiÃ³n actual.', 'ğŸ”„ Intentar Otra');
                return;
            }
            
            // Completar misiÃ³n
            gameState.completedMissions.push(wordData.mission);
            gameState.points += wordData.points;
            gameState.tools.push(wordData.tool);

            // AÃ±adir logro legible
            const achName = achievementNamesByMission[wordData.mission];
            if (achName && !gameState.achievements.includes(achName)) {
                gameState.achievements.push(achName);
            }

            // Si completÃ³ ambas misiones 3 y 4, aÃ±adir logro capÃ­tulo
            if (gameState.completedMissions.includes(3) && gameState.completedMissions.includes(4)) {
                if (!gameState.achievements.includes(chapterAchievement)) {
                    gameState.achievements.push(chapterAchievement);
                }
            }
            
// MisiÃ³n 3: Copia de Seguridad
if(wordData.tool === 'backup') {
    const toolName = 'Copia de Seguridad';
    const toolEmoji = 'ğŸ’¾';
    const points = wordData.points;
    const imageSrc = '3.jpg';
    const rewardText = 'ğŸ Recompensas: +10 puntos';

    // Crear contenido del modal
    const modalContent = document.createElement('div');
    modalContent.style.textAlign = 'center'; // Centrar todo

    // Mensaje principal
    const message = document.createElement('p');
    message.innerHTML = `Â¡Excelente! Has completado la misiÃ³n y obtenido ${toolEmoji} ${toolName} (+${points} puntos)`;
    modalContent.appendChild(message);

    // Imagen de la tarjeta
    const img = document.createElement('img');
    img.style.width = '500px';
    img.style.marginTop = '50px';
    img.src = imageSrc;
    img.alt = toolName;
    modalContent.appendChild(img);

    // Texto de recompensa
    const extra = document.createElement('p');
    extra.innerHTML = rewardText;
    extra.style.marginTop = '10px';
    extra.style.fontWeight = 'bold';
    modalContent.appendChild(extra);

    // Texto de tarjeta de colecciÃ³n
    const cardText = document.createElement('p');
    cardText.innerHTML = 'Â¡Obtuviste una tarjeta de colecciÃ³n!';
    cardText.style.marginTop = '20px';
    cardText.style.fontWeight = 'bold';
    modalContent.appendChild(cardText);

    // Mostrar modal
    showModal('Â¡MisiÃ³n Completada!', modalContent.outerHTML, 'ğŸ‰ Â¡Genial!');

    // Limpiar input
    document.getElementById('secretWordInput').value = '';
}

            saveGameState();
            updateUI();
            closeSecretWordModal();
            
        } else {
            showModal('Palabra Incorrecta', 'La palabra secreta no es vÃ¡lida. Verifica que hayas completado correctamente la misiÃ³n externa.', 'ğŸ”„ Intentar Otra');
        }
    }

    // Girar ruleta
    function spinRoulette() {
        if (gameState.points < 10) return;
        
        gameState.points -= 10;
        
        const wheel = document.getElementById('rouletteWheel');
        wheel.classList.add('roulette-wheel');
        
        setTimeout(() => {
            const prize = roulettePrizes[Math.floor(Math.random() * roulettePrizes.length)];
            
            if (prize.action === 'points') {
                gameState.points += 10;
                showModal('Â¡Premio de la Ruleta!', `Â¡Has ganado ${prize.emoji} ${prize.name}!`, 'ğŸ‰ Â¡Genial!');
            } else {
                showModal('Â¡Premio de la Ruleta!', `Â¡Has ganado ${prize.emoji} ${prize.name}! Puedes usarlo cuando lo necesites.`, 'ğŸ‰ Â¡Genial!');
            }
            
            wheel.classList.remove('roulette-wheel');
            saveGameState();
            updateUI();
        }, 4000);
    }

    // NavegaciÃ³n
    function goHome() {
        window.location.href = 'index.html';
    }

    function nextChapter() {
        window.location.href = 'capitulo3.html';
    }

    // Modal genÃ©rico
    function showModal(title, message, buttonText = 'âœ¨ Continuar', callback = null) {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-gradient-to-br from-purple-800 to-blue-800 rounded-xl p-8 max-w-md w-full mx-4 text-center">
                <h2 class="font-cinzel text-2xl font-bold mb-4">${title}</h2>
                <p class="text-lg mb-6">${message}</p>
                <button class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-3 rounded-lg font-semibold transition-all modal-ok">
                    ${buttonText}
                </button>
            </div>
        `;
        document.body.appendChild(modal);
        const okBtn = modal.querySelector('.modal-ok');
        okBtn.addEventListener('click', () => {
            modal.remove();
            if (typeof callback === 'function') callback();
        });
    }

    // Inicializar
    loadGameState();

    // BotÃ³n para contenido educativo
    document.addEventListener('DOMContentLoaded', function() {
        const missionsSection = document.getElementById('missionsSection');
        if (missionsSection) {
            const learningButton = document.createElement('div');
            learningButton.className = 'text-center mt-8';
            learningButton.innerHTML = `
                <button onclick="showLearning()" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 px-6 py-3 rounded-lg font-semibold transition-all">
                    ğŸ“š Ver Contenido Educativo
                </button>
            `;
            missionsSection.appendChild(learningButton);
        }

        if (!gameState.completedMissions || gameState.completedMissions.length === 0) {
            document.getElementById('storyIntro').style.display = 'block';
            document.getElementById('missionsSection').style.display = 'none';
            document.getElementById('learningContent').style.display = 'none';
            document.getElementById('chapterComplete').style.display = 'none';
            document.getElementById('mission3').style.display = 'block';
            document.getElementById('mission4').style.display = 'none';
        } else if (gameState.completedMissions.includes(3) && !gameState.completedMissions.includes(4)) {
            document.getElementById('storyIntro').style.display = 'none';
            document.getElementById('missionsSection').style.display = 'block';
            document.getElementById('mission3').style.display = 'none';
            document.getElementById('mission4').style.display = 'block';
        } else {
            document.getElementById('learningContent').style.display = 'none';
            document.getElementById('chapterComplete').style.display = 'none';
        }
    });
</script>

<!-- Footer decorativo similar a CapÃ­tulo 1 -->
<footer class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-blue-900 to-blue-700 text-white text-center py-2 font-inter text-sm select-none z-10">
    Â© 2024 Arcanum - CapÃ­tulo 2: El Reino de la Nube
</footer>
</body>
</html>
